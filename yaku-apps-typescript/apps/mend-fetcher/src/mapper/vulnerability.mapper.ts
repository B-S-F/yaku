// SPDX-FileCopyrightText: 2024 grow platform GmbH
//
// SPDX-License-Identifier: MIT

import { VulnerabilityDTO } from '../dto/vulnerability.dto.js'
import { Vulnerability } from '../model/vulnerability.js'
import { VulnerabilityReference } from '../model/vulnerabilityReference.js'

export class VulnerabilityMap {
  public static toModel(vulnerabilityDTO: VulnerabilityDTO) {
    const vulnerabilityReferences: VulnerabilityReference[] =
      vulnerabilityDTO.references && vulnerabilityDTO.references.length > 0
        ? vulnerabilityDTO.references.map(
            (ref) =>
              new VulnerabilityReference(
                ref.value,
                ref.source,
                ref.url,
                ref.signature,
                ref.advisory,
                ref.patch
              )
          )
        : []

    return new Vulnerability(
      vulnerabilityDTO.name,
      vulnerabilityDTO.type,
      vulnerabilityDTO.description,
      vulnerabilityDTO.score,
      vulnerabilityDTO.severity,
      vulnerabilityDTO.publishDate,
      vulnerabilityDTO.modifiedDate,
      vulnerabilityDTO.vulnerabilityScoring,
      vulnerabilityReferences
    )
  }

  public static toDTO(vulnerability: Vulnerability) {
    return new VulnerabilityDTO(
      vulnerability.name,
      vulnerability.type,
      vulnerability.description,
      vulnerability.score,
      vulnerability.severity,
      vulnerability.publishDate,
      vulnerability.modifiedDate,
      vulnerability.vulnerabilityScoring,
      vulnerability.references?.map((ref) => {
        return {
          value: ref.value,
          source: ref.source,
          url: ref.url,
          signature: ref.signature,
          advisory: ref.advisory,
          patch: ref.patch,
        }
      })
    )
  }
}
